<template>
  <div>
    <v-dialog v-model="isVehiclesOpen" max-width="600" :persistent="true" attach="body">
      <box background="white" class="vehicles-modal" resizable closable @closed="closeVehiclesModal()">
        <h3 slot="header" style="padding-right: 55px">
          {{ $t('optimization.manageVehicles') }}  {{ `editing ${editId}`}}
          <v-btn class="edit-vehicles-btn" flat :style="{background: 'white'}" @click="exportVehicles()" :title="$t('optimization.exportVehicleFile')">
            <v-icon color="primary">cloud_download</v-icon>
          </v-btn>
          <v-btn class="edit-vehicles-btn" flat :style="{background: 'white'}" @click="importVehicles()" :title="$t('optimization.importVehicleFile')">
            <v-icon color="primary">cloud_upload</v-icon>
          </v-btn>
          <v-btn class="edit-vehicles-btn" flat :style="{background: 'white', 'padding-right':'15px'}" @click="saveVehicles()" :title="$t('optimization.saveVehicles')">
            <v-icon color="success">save</v-icon>
          </v-btn>
        </h3>
        <v-card @click="editId = i+1" elevation="3" style="margin: 5px;cursor: pointer" v-for="(v, i) in editVehicles" :key="i">
          <v-card-title style="padding-bottom: 0;">
            <div><b>Vehicle {{ v.id }}</b></div>
            <v-btn v-if="editId === v.id" class="edit-btn" flat small :style="{background: 'white'}" @click.stop="editId = 0" :title="$t('optimization.editVehicle')">
              <v-icon color="primary">edit</v-icon>
            </v-btn>
            <v-btn class="remove-btn" small icon :style="{background: 'white'}" @click.stop="removeVehicle(v.id)" :title="$t('optimization.removeVehicle')">
              <v-icon color="primary">delete</v-icon>
            </v-btn>
          </v-card-title>
          <v-card-text>
            <div v-if="editId !== v.id">Location: {{ v }}</div>
            <div v-else>
              <v-text-field v-model="editVehicles[i].start" :persistent-hint="true" :hint="'Start & End'"></v-text-field>
              <v-text-field v-model.number="editVehicles[i].capacity[0]" :persistent-hint="true" :hint="'Capacity'"></v-text-field>
              <v-select v-model="selectedSkills" :items="vehicleSkills" item-text="name" item-value="id" :persistent-hint="true" :hint="'Skills needed for this Job'" multiple>
                <template v-slot:append-item>
                  <v-divider class="mt-2"></v-divider>
                  <v-btn @click="manageSkills">
                    <v-icon :title="$t('optimization.manageSkills')" color="dark" :medium="$lowResolution">settings</v-icon>
                    {{ 'manage Skills' }}
                  </v-btn>
                </template>
              </v-select>
              <v-text-field v-model="editVehicles[i].time_window" :persistent-hint="true" :hint="'Working time window of this Vehicle (in seconds passed since 00:00 or timestamp'"></v-text-field>
            </div>
          </v-card-text>
        </v-card>
        <v-layout row :wrap="$lowResolution">
          <v-spacer class="hidden-md-and-down"></v-spacer>
          <v-flex text-xs-right xs12 sm5 md7 :class="{'ml-2': $vuetify.breakpoint.smAndDown, 'mb-2': $lowResolution}">
            <v-btn :block="$lowResolution" color="primary" :title="$t('settings.restoreDefaults')"
                   @click="closeVehiclesModal">{{$t('global.cancel')}}</v-btn>
          </v-flex>
          <v-flex text-xs-right xs12 sm3 md3 :class="{'ml-2': $vuetify.breakpoint.smAndDown}">
            <v-btn :block="$lowResolution" color="success" :title="$t('global.save')" @click="saveVehicles">
              {{$t('global.save')}}</v-btn>
          </v-flex>
        </v-layout>
      </box>
    </v-dialog>
    <edit-skills v-if="showSkillManagement" :skills="skills" @skillsChanged="skillsChanged" @close="showSkillManagement=false"></edit-skills>
  </div>
</template>

<script src="./edit-vehicles.js"></script>
<style scoped src="./edit-vehicles.css"></style>
